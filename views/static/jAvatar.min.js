var canvasSize=300,iconSize=60,canvas=document.getElementById("jallowPinsCanvas"),image=$("#avatarImg"),ctx=canvas.getContext("2d"),pixelRatio=getPixelRatio(ctx),canvasRealWidth=canvasSize*pixelRatio,canvasRealHeight=canvasRealWidth;canvas.width=canvasRealWidth,canvas.height=canvasRealHeight;var iconRealSize=iconSize*pixelRatio;function drawAvatar(a){var e=new Image;e.src=a,e.onload=function(){window.EXIF.getData(e,function(){switch(EXIF.getTag(this,"Orientation")){case 3:ctx.rotate(Math.PI),ctx.drawImage(e,-canvasRealWidth,-canvasRealHeight,canvasRealWidth,canvasRealHeight),ctx.rotate(-Math.PI);break;case 6:ctx.rotate(.5*Math.PI),ctx.drawImage(e,0,-canvasRealHeight,canvasRealWidth,canvasRealHeight),ctx.rotate(-.5*Math.PI);break;case 8:ctx.rotate(3*Math.PI/2),ctx.drawImage(e,canvasRealWidth,0,canvasRealWidth,canvasRealHeight),ctx.rotate(-3*Math.PI/2);break;default:ctx.drawImage(e,0,0,canvasRealWidth,canvasRealHeight)}}),drawCanvas2Image(),changeCanvasImageVisible(!0),changeIconBannerVisible(!0),changeDownloadBtnVisible(!0)}}function drawCanvas2Image(){var a=canvas.toDataURL("image/png");image.attr("src",a)}function drawIconBorder(){ctx.beginPath(),ctx.arc(.675*canvasRealWidth+iconRealSize/2,.675*canvasRealHeight+iconRealSize/2,iconRealSize/2+8,0,2*Math.PI),ctx.fillStyle="#fff",ctx.fill()}function drawIcon(a){var e=new Image;e.src=a,e.onload=function(){drawIconBorder(),ctx.drawImage(e,.675*canvasRealWidth,.675*canvasRealHeight,iconRealSize,iconRealSize),drawCanvas2Image()}}function changeCanvasImageVisible(a){image.css("display",a?"block":"none")}function changeIconBannerVisible(a){$(".divider").css("visibility",a?"visible":"hidden"),$(".icon-banners").css("visibility",a?"visible":"hidden"),$(".icon-banners").css("height",a?"auto":"0")}function changeDownloadBtnVisible(a){$(".download-btn").css("visibility",a?"visible":"hidden")}function inputChangeListener(){$("#avatar").change(function(a){var e=a.target.files[0],n=new FileReader;n.readAsDataURL(e),n.onloadend=function(a){drawAvatar(a.target.result)}})}function iconClickListener(){$(".icon-banners").click(function(a){"IMG"===a.target.nodeName&&drawIcon(a.target.src,pixelRatio)})}function getPixelRatio(a){var e=a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}function downloadCanvasImg(){var a="image/png",e=canvas.toDataURL(a),n=document.createElement("a");n.download="JallowPinsAvatar",n.href=e,n.dataset.downloadurl=[a,n.download,n.href].join(":"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function downloadBtnListener(){$(".download-btn").click(downloadCanvasImg)}$(document).ready(function(){console.log("(ï½¡ï½¥Ï‰ï½¥ï½¡)ï¾‰ðŸ’›ï½ž document ready"),inputChangeListener(),iconClickListener(),downloadBtnListener()});